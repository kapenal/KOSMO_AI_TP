<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²€ìƒ‰ ê²°ê³¼</title>
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ search_textì„ ë°›ì•„ì„œ inputì— ë„£ì–´ì£¼ê¸°
        window.onload = function () {
            const urlParams = new URLSearchParams(window.location.search);
            const encodedMovieData = urlParams.get('search_movie');
            const keyword = urlParams.get('keyword');

            console.log("ğŸ“¦ ì¸ì½”ë”©ëœ ë°ì´í„°:", encodedMovieData);

            if (encodedMovieData) {
                try {
                    const movieData = JSON.parse(decodeURIComponent(encodedMovieData));

                    // if (Array.isArray(movieData)) {
                    //     // ì˜í™” ë¦¬ìŠ¤íŠ¸ì¼ ê²½ìš° ì¶œë ¥
                    //     movieData.forEach(movie => {
                    //         console.log("ğŸ¬ ì œëª©:", movie.ì œëª©)
                    //         console.log("â­ï¸ ë³„ì :", movie.ë³„ì )
                    //         console.log("ğŸ“ ê°œìš”:", movie.ê°œìš”)
                    //         console.log("ğŸ–¼ í¬ìŠ¤í„°:", movie.í¬ìŠ¤í„°);
                    //         // HTMLì— ì¶œë ¥
                    //         document.getElementById('search_text').value = movie.ì œëª©;
                    //     });
                    // } else if (movieData.message) {
                    //     // ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥
                    //     console.log("âŒ ë©”ì‹œì§€:", movieData.message);
                    //     document.getElementById("result").innerText = movieData.message;
                    // } else {
                    //     console.log("âš ï¸ ì˜ˆìƒí•˜ì§€ ëª»í•œ ë°ì´í„° êµ¬ì¡°:", movieData);
                    // }

                    // ğŸ”§ [ìˆ˜ì • 1] messageê°€ ìˆëŠ” ê²½ìš° ë¨¼ì € ì²˜ë¦¬í•˜ê³  í•˜ë‹¨ ë¡œì§ ì‹¤í–‰ ì•ˆ í•˜ê²Œ return
                    if (movieData.message) {
                        const movieInfoDiv = document.getElementById('movie_info');
                        if (movieInfoDiv) {
                            movieInfoDiv.innerHTML = `<p>${movieData.message}</p>`;
                        }
                        document.getElementById('search_text').value = keyword;
                        return;  // ğŸ‘ˆ ë°˜ë“œì‹œ returní•´ì„œ ì•„ë˜ ì½”ë“œ ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡
                    }

                    // ğŸ”§ [ì¶”ê°€] movieDataê°€ ë¹ˆ ë°°ì—´ì´ë©´ "ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ" ë©”ì‹œì§€ ì¶œë ¥
                    if (Array.isArray(movieData) && movieData.length === 0) {
                        const movieInfoDiv = document.getElementById('movie_info');
                        if (movieInfoDiv) {
                            movieInfoDiv.innerHTML = "<p>âŒ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
                        }
                        document.getElementById('search_text').value = keyword;
                        return;
                    }

                    // ë°°ì—´ ì²« ë²ˆì§¸ ì˜í™” ë°ì´í„° ì‚¬ìš©
                    const movie = movieData[0];

                    // âœ… ì–´ë–¤ í•„ë“œì—ì„œ keywordê°€ í¬í•¨ë˜ì—ˆëŠ”ì§€ ë³´ê³  input ì°½ì— í‘œì‹œ
                    if (keyword && movie.ì œëª©.includes(keyword)) {
                        document.getElementById('search_text').value = movie.ì œëª©;
                    } else if (keyword && movie.ê°œìš”.includes(keyword)) {
                        document.getElementById('search_text').value = movie.ê°œìš”;
                    } else {
                        document.getElementById('search_text').value = keyword;
                    }

                    // ê²°ê³¼ ì˜ì—­ì— ì˜í™” ì •ë³´ í‘œì‹œ
                    document.getElementById('title').innerText = "ğŸ¬ " + movie.ì œëª©;
                    document.getElementById('rating').innerText = "â­ï¸ ë³„ì : " + movie.ë³„ì ;
                    document.getElementById('overview').innerText = "ğŸ“ ê°œìš”: " + movie.ê°œìš”;
                    document.getElementById('poster').src = movie.í¬ìŠ¤í„°;

                    // âœ… ë¸Œë¼ìš°ì € íƒ­ ì œëª© ì„¤ì •
                    document.title = movie.ì œëª© + "- ë¬´ë¹„ ì„¼ì„œìŠ¤ ê²€ìƒ‰ê²°ê³¼";

                } catch (e) {
                    console.error("âŒ JSON íŒŒì‹± ì˜¤ë¥˜:", e);
                }
            } else {
                console.log("âš ï¸ search_movie íŒŒë¼ë¯¸í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                // ğŸ”§ search_movie íŒŒë¼ë¯¸í„° ìì²´ê°€ ì—†ì„ ë•Œë„ ë©”ì‹œì§€ ì¶œë ¥
                const movieInfoDiv = document.getElementById('movie_info');
                if (movieInfoDiv) {
                    movieInfoDiv.innerHTML = "<p>âŒ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
                }
                document.getElementById('search_text').value = keyword;
            }
        };

    </script>
</head>
<body>
    <h1>ë¬´ë¹„ì„¼ì„œìŠ¤</h1>
    <p>ê²€ìƒ‰ <input type="text" id="search_text"></p>
    <button id="search_btn">ê²€ìƒ‰</button>
    <button id="detail_btn">ìƒì„¸ í˜ì´ì§€</button>
    <button id="list_btn">ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€</button>
    <script src="../js/search.js"></script>
    <script src="../js/detail_page.js"></script>
    <script src="../js/list_page.js"></script>

    <!-- ì˜í™” ì •ë³´ í‘œì‹œ ì˜ì—­ -->
    <div id="movie_info">
        <h2 id="title">ğŸ¬ ì œëª©</h2>
        <p id="rating">â­ï¸ ë³„ì </p>
        <p id="overview">ğŸ“ ê°œìš”</p>
        <img id="poster" src="" alt="í¬ìŠ¤í„° ì´ë¯¸ì§€" style="max-width:200px;">
    </div>

    <!--ì˜í™” ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ ì˜ì—­-->
    <div id="search_result_container" style="display: flex; flex-wrap: wrap;"></div>
</body>

</html>